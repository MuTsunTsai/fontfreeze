!function(){const{reactive:e,createApp:t}=PetiteVue,n=new Worker("worker.js"),a=new Promise(((e,t)=>{const a=o=>{"initialized"==o.data?(n.removeEventListener("message",a),e()):"error"in o.data?t(new Error(o.data.error)):"progress"in o.data&&i.loading&&(i.loading=`packages (${o.data.progress}%)`)};n.addEventListener("message",a)})),o=document.createElement("style"),i=e({localFontSupport:"queryLocalFonts"in window,localFonts:[],localFont:"",unavailableFonts:[],loading:null,font:null,sample:"",removeGlyphs:"",previewSize:12,running:!1,message:null,previewIndex:0,version:""}),r=["abvm","abvs","akhn","blwf","blwm","blws","ccmp","cfar","cjct","curs","dist","dtls","fin2","fin3","fina","flac","half","haln","init","isol","ljmo","locl","ltra","ltrm","mark","med2","medi","mkmk","nukt","pref","pres","pstf","psts","rclt","rkrf","rlig","rphf","rtla","rtlm","rvrn","ssty","stch","tjmo","vjmo","DELT"],s={ital:"Italic",opsz:"Optical size",slnt:"Slant",wdth:"Width",wght:"Weight"},l={ttf:{description:"TTF font",accept:{"font/ttf":".ttf"}},woff2:{description:"WOFF2 font",accept:{"font/woff2":".woff2"}}},f="Please try re-exporting the font with editors such as FontForge and see if it fixes the issue. If it still doesn't, please submit an issue.",c=e=>bootstrap.Modal.getOrCreateInstance(e);let u,g;function d(e,t){return new Promise(((a,o)=>{const i=new MessageChannel;n.postMessage([e,t],[i.port2]),i.port1.onmessage=e=>{const{success:t,data:n}=e.data;t?a(n):o(new Error(n))}}))}function p(){const e=new Promise((e=>{addEventListener("animationstart",e,{once:!0})}));return i.running=!0,e}function m(){return i.font.fileName.replace(/\.[a-z0-9]+$/i,"")+"_freeze."+i.options.format}function v(e){return JSON.parse(JSON.stringify(e))}async function w(){try{for(let e in i.variations)i.variations[e]=Number(i.variations[e]);const e={options:i.options,version:i.version,unicodes:F(),variations:i.variations,features:i.font.gsub.filter((e=>!0===i.features[e])),disables:i.font.gsub.filter((e=>void 0===i.features[e]))};return await d("save",v(e))}catch(e){throw alert("An error occur: "+e.message),e}}async function h(e){gtag("event","open_ttf");try{await y(e,e.name)}catch(t){console.log(t),alert(`"${e.name}" is not a valid font file, or is corrupted. Please try re-exporting the font with editors such as FontForge and see if it fixes the issue. If it still doesn't, please submit an issue.`)}}async function y(e,t){i.loading="packages",await a,i.loading="font";let n,o=URL.createObjectURL(e);try{n=await d("open",o)}catch(e){throw URL.revokeObjectURL(o),i.loading=null,e}console.log(v(n)),n.preview&&(URL.revokeObjectURL(o),o=n.preview),n.fileName=t,n.fileSize=function(e){if(e<1024)return e+"B";e/=1024;if(e<1024)return e.toFixed(1)+"KiB";e/=1024;return e.toFixed(1)+"MiB"}(e.size),n.gsub=n.gsub.filter((e=>!r.includes(e))),i.features={},u={},i.variations={},i.removeGlyphs="",i.options={family:n.family+" Freeze",subfamily:"Regular",fixContour:!1,singleSub:!0,target:"calt",format:"ttf"};for(let e of n.gsub)i.features[e]=u[e]=!1;if(n.fvar)for(let e of n.fvar.axes)i.variations[e.tag]=e.default;i.font=n,await b(o),i.loading=null}async function b(e){if(!await L(e)){if(!info.preview)try{const e=await d("legacy");if(await L(e))return}catch(e){console.log(e)}gtag("event","preview_failed"),alert("Font preview won't work for this font. "+f)}}function F(){const e=function(){const e=[];for(let t=0;t<i.removeGlyphs.length;t++)e.push(i.removeGlyphs.charCodeAt(t));return e.sort(),e}(),t=[[0,1114111]];if(0==e.length)return"";for(let n of e){const e=t.find((e=>e[0]<=n&&n<=e[1]));if(!e)continue;const a=e[1];e[1]=n-1,t.push([n+1,a])}return t.filter((e=>e[0]<=e[1])).map((e=>`U+${e[0].toString(16)}-${e[1].toString(16)}`)).join(",")}function L(e){return g&&URL.revokeObjectURL(g),g=e,o.sheet.cssRules.length>0&&o.sheet.deleteRule(0),new Promise((e=>{document.fonts.onloadingdone=t=>{e(t.fontfaces.length>0)},o.sheet.insertRule(`@font-face {font-family: preview${++i.previewIndex};src: url('${g}');}`)}))}document.head.appendChild(o),fetch("sample.txt").then((e=>e.text())).then((e=>i.sample=e)),fetch("https://img.shields.io/github/package-json/v/mutsuntsai/fontfreeze.json").then((e=>e.json())).then((e=>i.version=" "+e.value)),addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".dropzone"),n=(t,n)=>{t.stopPropagation(),t.preventDefault(),e.classList.toggle("drag",n)};document.body.addEventListener("dragover",(e=>n(e,!0))),e.addEventListener("dragleave",(e=>n(e,!1))),e.addEventListener("drop",(e=>{n(e,!1);const t=[...e.dataTransfer.items].find((e=>"file"==e.kind));t&&h(t.getAsFile())})),t({store:i,get previewStyle(){if(!i.font)return null;const e=i.font.gsub.filter((e=>!1!==i.features[e])).map((e=>`'${e}' ${i.features[e]?"on":"off"}`)).join(","),t=i.font.fvar?i.font.fvar.axes.map((e=>`'${e.tag}' ${i.variations[e.tag]}`)).join(","):"normal";return`white-space: pre-line;font-family: preview${i.previewIndex};font-feature-settings: ${e};font-variation-settings: ${t};font-size: ${i.previewSize}pt;`},get more(){const e=i.font;return!!e&&(e.description||e.designer||e.manufacturer||e.copyright||e.trademark)},get instances(){return i.font&&i.font.fvar?i.font.fvar.instances:[]},get axes(){return i.font&&i.font.fvar?i.font.fvar.axes:[]},getAxisName:e=>e.name?e.name:e.tag in s?s[e.tag]:e.tag,setInstance(e){for(let t in e.coordinates)i.variations[t]=e.coordinates[t]},getStep(e){const t=e.max-e.min;return t>20?1:t>1?.1:.01},clear(){const e=document.getElementsByTagName("select")[0];e&&(e.value="")},checkboxChange(e){!0===u[e]&&(i.features[e]=void 0),void 0===u[e]&&(i.features[e]=!1),u[e]=i.features[e]},info(){c("#info").show()},setUnicodeRange(){o.sheet.cssRules[0].style.unicodeRange=F()},optionStyle(e){if(!e){if(!i.localFont)return"";e=i.localFonts[i.localFont]}return`font-family:'${e.fullName}', '${e.postscriptName}', '${e.family}'`},async local(){gtag("event","show_local"),await navigator.permissions.query({name:"local-fonts",description:""});const e=await window.queryLocalFonts();0!=e.length&&(i.localFonts=e,c("#local").show())},async loadLocal(){gtag("event","open_local");const e=i.localFonts[i.localFont];let t;try{t=await e.blob()}catch(t){return alert("An error occur: "+t.message),void i.unavailableFonts.push(e.postscriptName)}finally{i.localFont=""}c("#local").hide();try{await y(t,e.fullName)}catch(e){alert("An error occur: "+e.message)}}}).mount()})),globalThis.generate=async function(){if(!i.message){gtag("event","save_"+i.options.format);try{if("showSaveFilePicker"in window){i.message=null;const e=await showSaveFilePicker({suggestedName:m(),types:[l[i.options.format]]});await p();const t=await w(),n=await fetch(t),a=await n.arrayBuffer(),o=new Blob([a],{type:"font/"+i.options.format}),r=await e.createWritable();await r.write(o),await r.close(),i.message="Generating complete!",setTimeout((()=>i.message=null),3e3)}else await p(),i.url=await w(),i.download=m()}catch(e){console.log(e)}i.running=!1}},globalThis.openFile=async function(e){const t=e.files[0];t&&(e.value="",h(t))}}();