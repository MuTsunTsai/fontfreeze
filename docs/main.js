!function(){const{reactive:t,createApp:e}=PetiteVue,n=new Worker("worker.js"),a=new Promise(((t,e)=>{const a=o=>{"initialized"==o.data?(n.removeEventListener("message",a),t()):"error"in o.data?e(new Error(o.data.error)):"progress"in o.data&&i.loading&&(i.loading=`packages (${o.data.progress}%)`)};n.addEventListener("message",a)}));function o(t,e){return new Promise(((a,o)=>{const r=new MessageChannel;n.postMessage([t,e],[r.port2]),r.port1.onmessage=t=>{const{success:e,data:n}=t.data;e?a(n):o(new Error(n))}}))}const r=document.createElement("style");let s;document.head.appendChild(r);const i=t({localFontSupport:"queryLocalFonts"in window,localFonts:[],localFont:"",unavailableFonts:[],loading:null,font:null,sample:"",removeGlyphs:"",previewSize:12,running:!1,message:null,previewIndex:0,version:""});fetch("sample.txt").then((t=>t.text())).then((t=>i.sample=t)),fetch("https://img.shields.io/github/package-json/v/mutsuntsai/fontfreeze.json").then((t=>t.json())).then((t=>i.version=" "+t.value)),addEventListener("DOMContentLoaded",(()=>e({store:i,get previewStyle(){if(!i.font)return null;const t=i.font.gsub.filter((t=>!1!==i.features[t])).map((t=>`'${t}' ${i.features[t]?"on":"off"}`)).join(","),e=i.font.fvar?i.font.fvar.axes.map((t=>`'${t.tag}' ${i.variations[t.tag]}`)).join(","):"normal";return`\n\t\t\t\twhite-space: pre-line;\n\t\t\t\tfont-family: preview${i.previewIndex};\n\t\t\t\tfont-feature-settings: ${t};\n\t\t\t\tfont-variation-settings: ${e};\n\t\t\t\tfont-size: ${i.previewSize}pt;`},get more(){const t=i.font;return!!t&&(t.description||t.designer||t.manufacturer||t.copyright||t.trademark)},get instances(){return i.font&&i.font.fvar?i.font.fvar.instances:[]},get axes(){return i.font&&i.font.fvar?i.font.fvar.axes:[]},getAxisName:t=>t.name?t.name:t.tag in c?c[t.tag]:t.tag,setInstance(t){for(let e in t.coordinates)i.variations[e]=t.coordinates[e]},getStep(t){const e=t.max-t.min;return e>20?1:e>1?.1:.01},clear(){const t=document.getElementsByTagName("select")[0];t&&(t.value="")},checkboxChange(t){!0===s[t]&&(i.features[t]=void 0),void 0===s[t]&&(i.features[t]=!1),s[t]=i.features[t]},info(){bootstrap.Modal.getOrCreateInstance("#info").show()},setUnicodeRange(){r.sheet.cssRules[0].style.unicodeRange=v()},optionStyle(t){if(!t){if(!i.localFont)return"";t=i.localFonts[i.localFont]}return`font-family:'${t.fullName}', '${t.postscriptName}', '${t.family}'`},async local(){await navigator.permissions.query({name:"local-fonts",description:""});const t=await window.queryLocalFonts();0!=t.length&&(i.localFonts=t,bootstrap.Modal.getOrCreateInstance("#local").show())},async loadLocal(){const t=i.localFonts[i.localFont];let e;try{e=await t.blob()}catch(e){return alert("An error occur: "+e.message),void i.unavailableFonts.push(t.postscriptName)}finally{i.localFont=""}bootstrap.Modal.getOrCreateInstance("#local").hide();try{await d(e,t.fullName)}catch(t){alert("An error occur: "+t.message)}}}).mount()));const l=["abvm","abvs","akhn","blwf","blwm","blws","ccmp","cfar","cjct","curs","dist","dtls","fin2","fin3","fina","flac","half","haln","init","isol","ljmo","locl","ltra","ltrm","mark","med2","medi","mkmk","nukt","pref","pres","pstf","psts","rclt","rkrf","rlig","rphf","rtla","rtlm","rvrn","ssty","stch","tjmo","vjmo","DELT"],c={ital:"Italic",opsz:"Optical size",slnt:"Slant",wdth:"Width",wght:"Weight"},f={ttf:{description:"TTF font",accept:{"font/ttf":".ttf"}},woff2:{description:"WOFF2 font",accept:{"font/woff2":".woff2"}}};function u(){const t=new Promise((t=>{window.addEventListener("animationstart",t,{once:!0})}));return i.running=!0,t}function g(){return i.font.fileName.replace(/\.[a-z0-9]+$/i,"")+"_freeze."+i.options.format}function m(t){return JSON.parse(JSON.stringify(t))}async function p(){try{for(let t in i.variations)i.variations[t]=Number(i.variations[t]);const t={options:i.options,version:i.version,unicodes:v(),variations:i.variations,features:i.font.gsub.filter((t=>!0===i.features[t])),disables:i.font.gsub.filter((t=>void 0===i.features[t]))};return await o("save",m(t))}catch(t){throw alert("An error occur: "+t.message),t}}async function d(t,e){i.loading="packages",await a,i.loading="font";const n=URL.createObjectURL(t);let c;try{c=await o("open",n)}catch(t){throw URL.revokeObjectURL(n),t}finally{i.loading=null}console.log(m(c)),function(t){w&&URL.revokeObjectURL(w);w=t,r.sheet.cssRules.length>0&&r.sheet.deleteRule(0);r.sheet.insertRule(`@font-face {\n\t\t\tfont-family: preview${++i.previewIndex};\n\t\t\tsrc: url('${w}');\n\t\t}`)}(n),c.fileName=e,c.fileSize=function(t){if(t<1024)return t+"B";t/=1024;if(t<1024)return t.toFixed(1)+"KiB";t/=1024;return t.toFixed(1)+"MiB"}(t.size),c.gsub=c.gsub.filter((t=>!l.includes(t))),i.features={},s={},i.variations={},i.removeGlyphs="",i.options={family:c.family+" Freeze",subfamily:"Regular",fixContour:!1,singleSub:!0,target:"calt",format:"ttf"};for(let t of c.gsub)i.features[t]=s[t]=!1;if(c.fvar)for(let t of c.fvar.axes)i.variations[t.tag]=t.default;i.font=c}function v(){const t=function(){const t=[];for(let e=0;e<i.removeGlyphs.length;e++)t.push(i.removeGlyphs.charCodeAt(e));return t.sort(),t}(),e=[[0,1114111]];if(0==t.length)return"";for(let n of t){const t=e.find((t=>t[0]<=n&&n<=t[1]));if(!t)continue;const a=t[1];t[1]=n-1,e.push([n+1,a])}return e.filter((t=>t[0]<=t[1])).map((t=>`U+${t[0].toString(16)}-${t[1].toString(16)}`)).join(",")}let w;globalThis.generate=async function(){if(!i.message){gtag("event","save_"+i.options.format);try{if("showSaveFilePicker"in window){i.message=null;const t=await showSaveFilePicker({suggestedName:g(),types:[f[i.options.format]]});await u();const e=await p(),n=await fetch(e),a=await n.arrayBuffer(),o=new Blob([a],{type:"font/"+i.options.format}),r=await t.createWritable();await r.write(o),await r.close(),i.message="Generating complete!",setTimeout((()=>i.message=null),3e3)}else await u(),i.url=await p(),i.download=g()}catch(t){console.log(t)}i.running=!1}},globalThis.openFile=async function(t){gtag("event","open_ttf");const e=t.files[0];if(e){t.value="";try{await d(e,e.name)}catch(t){console.log(t),alert(`"${e.name}" is not a valid font file.`)}}}}();