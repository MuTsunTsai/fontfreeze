!function(){const{reactive:e,createApp:t}=PetiteVue,n=new Worker("worker.js"),o=new Promise(((e,t)=>{const o=a=>{"initialized"==a.data?(n.removeEventListener("message",o),e()):"error"in a.data?t(new Error(a.data.error)):"progress"in a.data&&s.loading&&(s.loading=`packages (${a.data.progress}%)`)};n.addEventListener("message",o)})),a=document.createElement("style");document.head.appendChild(a);const i=document.createElement("style");document.head.appendChild(i);const s=e({localFonts:[],localFont:"",localFamily:"",unavailableFonts:[],unicodeRange:"",loading:null,font:null,sample:"",glyphs:"",subsetMode:"exclude",previewSize:12,running:!1,message:null,previewIndex:0,version:""}),r=["abvm","abvs","akhn","blwf","blwm","blws","ccmp","cfar","cjct","curs","dist","dtls","fin2","fin3","fina","flac","half","haln","init","isol","ljmo","locl","ltra","ltrm","mark","med2","medi","mkmk","nukt","pref","pres","pstf","psts","rclt","rkrf","rlig","rphf","rtla","rtlm","rvrn","ssty","stch","tjmo","vjmo","DELT"],l={ital:"Italic",opsz:"Optical size",slnt:"Slant",wdth:"Width",wght:"Weight"},f={ttf:{description:"TTF font",accept:{"font/ttf":".ttf"}},woff2:{description:"WOFF2 font",accept:{"font/woff2":".woff2"}}},c="Please try re-exporting the font with editors such as FontForge and see if it fixes the issue. If it still doesn't, please submit an issue.",u=e=>bootstrap.Modal.getOrCreateInstance(e);let d,m;function g(e,t){return new Promise(((o,a)=>{const i=new MessageChannel;n.postMessage([e,t],[i.port2]),i.port1.onmessage=e=>{const{success:t,data:n}=e.data;t?o(n):a(new Error(n))}}))}function p(e,t){let n=window.getSelection(),o=e.textContent,a=Math.min(n.focusOffset,n.anchorOffset),i=Math.max(n.focusOffset,n.anchorOffset),s=o.substring(i);""==s&&(s="\n"),e.textContent=o.substring(0,a)+t+s,n.removeAllRanges();let r=document.createRange();r.setStart(e.childNodes[0],a+t.length),r.setEnd(e.childNodes[0],a+t.length),n.addRange(r)}function h(){const e=new Promise((e=>{addEventListener("animationstart",e,{once:!0})}));return s.running=!0,e}function y(){return s.font.fileName.replace(/\.[a-z0-9]+$/i,"")+"_freeze."+s.options.format}function v(e){return JSON.parse(JSON.stringify(e))}async function w(){try{for(let e in s.variations)s.variations[e]=Number(s.variations[e]);s.options.family=s.options.family.trim(),s.options.typo_subfamily=s.options.typo_subfamily.trim();const e=v(s.options);e.suffix&&(e.family&&e.family.length+e.suffix.length<32&&(e.family+=" "+e.suffix),e.typo_family&&(e.typo_family+=" "+e.suffix));const t={options:e,version:s.version,unicodes:R(),variations:s.variations,features:s.font.gsub.filter((e=>!0===s.features[e])),disables:s.font.gsub.filter((e=>void 0===s.features[e]))};return await g("save",v(t))}catch(e){throw alert("An error occur: "+e.message),e}}async function b(e){gtag("event","open_ttf");try{await F(e,e.name)}catch(t){console.log(t),alert(`"${e.name}" is not a valid font file, or is corrupted. `+c)}}async function F(e,t){s.loading="packages",await o,s.loading="font";let n,a=URL.createObjectURL(e);try{n=await g("open",a)}catch(e){throw URL.revokeObjectURL(a),s.loading=null,e}console.log(v(n)),n.preview&&(URL.revokeObjectURL(a),a=n.preview),n.fileName=t,n.fileSize=function(e){if(e<1024)return e+"B";e/=1024;if(e<1024)return e.toFixed(1)+"KiB";e/=1024;return e.toFixed(1)+"MiB"}(e.size),n.gsub=n.gsub.filter((e=>!r.includes(e))),s.features={},d={},s.variations={},s.glyphs="",s.options={suffix:"Freeze",family:n.family,subfamily:n.subfamily,typo_family:n.typo_family||n.family,typo_subfamily:n.typo_subfamily||"",fixContour:!1,singleSub:!0,customNames:!1,target:"calt",format:"ttf"};for(let e of n.gsub)s.features[e]=d[e]=!1;if(n.fvar)for(let e of n.fvar.axes)s.variations[e.tag]=e.default;s.font=n,await x(a),s.loading=null}async function x(e){if(!await k(e)){if(!info.preview)try{const e=await g("legacy");if(await k(e))return}catch(e){console.log(e)}gtag("event","preview_failed"),alert("Font preview won't work for this font. "+c)}}function L(e){let t="U+"+e[0].toString(16);return e[1]>e[0]&&(t+="-"+e[1].toString(16)),t}function R(){const e=function(){const e=new Set;for(let t=0;t<s.glyphs.length;t++){const n=s.glyphs.codePointAt(t);s.glyphs.charCodeAt(t)!=n&&t++,e.add(n)}const t=[...e];return t.sort(((e,t)=>e-t)),t}();if("exclude"==s.subsetMode){const t=[[0,1114111]];if(0==e.length)return"";for(const n of e){const e=t.find((e=>e[0]<=n&&n<=e[1]));if(!e)continue;const o=e[1];e[1]=n-1,t.push([n+1,o])}return t.filter((e=>e[0]<=e[1])).map(L).join(", ").toUpperCase()}{if(0==e.length)return"U+0";const t=[];let n=e[0],o=n;for(let a=1;a<=e.length;a++){const i=e[a];o==i-1||(t.push([n,o]),n=i),o=i}return t.map(L).join(", ").toUpperCase()}}function k(e){return m&&URL.revokeObjectURL(m),m=e,a.sheet.cssRules.length>0&&a.sheet.deleteRule(0),new Promise((e=>{document.fonts.onloadingdone=t=>{e(t.fontfaces.length>0)},a.sheet.insertRule(`@font-face {font-family: preview${++s.previewIndex};src: url('${m}');}`)}))}fetch("sample.txt").then((e=>e.text())).then((e=>s.sample=e)),fetch("https://img.shields.io/github/package-json/v/mutsuntsai/fontfreeze.json").then((e=>e.json())).then((e=>s.version=" "+e.value)),addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector(".dropzone"),n=(t,n)=>{t.stopPropagation(),t.preventDefault(),e.classList.toggle("drag",n)};document.body.addEventListener("dragover",(e=>n(e,!0))),e.addEventListener("dragleave",(e=>n(e,!1))),e.addEventListener("drop",(e=>{n(e,!1);const t=[...e.dataTransfer.items].find((e=>"file"==e.kind));t&&b(t.getAsFile())})),t({chromiumVersion:parseInt(navigator.userAgentData?.brands.find((e=>"Chromium"==e.brand))?.version??0),localFontSupport:"queryLocalFonts"in window,store:s,get previewStyle(){if(!s.font)return null;const e=s.font.gsub.filter((e=>!1!==s.features[e])).map((e=>`'${e}' ${s.features[e]?"on":"off"}`)).join(","),t=s.font.fvar?s.font.fvar.axes.map((e=>`'${e.tag}' ${s.variations[e.tag]}`)).join(","):"normal";return`white-space: pre-line;font-family: preview${s.previewIndex};font-feature-settings: ${e};font-variation-settings: ${t};font-size: ${s.previewSize}pt;`},get more(){const e=s.font;return!!e&&(e.description||e.designer||e.manufacturer||e.copyright||e.trademark)},get instances(){return s.font&&s.font.fvar?s.font.fvar.instances:[]},get axes(){return s.font&&s.font.fvar?s.font.fvar.axes:[]},get localFamilies(){if(!s.localFonts.length)return[];const e=new Set;for(const t of s.localFonts)e.add(t.family);return[...e]},getAxisName:e=>e.name?e.name:e.tag in l?l[e.tag]:e.tag,setInstance(e){s.options.typo_subfamily=e.name;for(let t in e.coordinates)s.variations[t]=e.coordinates[t]},getStep(e){const t=e.max-e.min;return t>20?1:t>1?.1:.01},clear(){const e=document.getElementsByTagName("select")[0];e&&(e.value="")},checkboxChange(e){!0===d[e]&&(s.features[e]=void 0),void 0===d[e]&&(s.features[e]=!1),d[e]=s.features[e]},info(){u("#info").show()},setUnicodeRange(){a.sheet.cssRules[0].style.unicodeRange=s.unicodeRange=R()},optionStyle(e){if(!e){if(""===s.localFont)return"";e=s.localFonts[s.localFont]}return`font-family:'local ${e.fullName}'`},familyStyle(e=s.localFamily){const t=s.localFonts.filter((t=>t.family==e));if(!t.length)return"";let n=t.find((e=>"Regular"==e.style));return n||(t.sort(((e,t)=>e.fullName.length-t.fullName.length)),n=t[0]),`font-family:'local ${n.fullName}'`},familyChange(){s.localFont=s.localFonts.findIndex((e=>e.family==s.localFamily))},setupDiv(){const e=document.querySelector("div.pre");!function(e){try{const t="plaintext-only";return e.contentEditable=t,e.contentEditable==t}catch(e){return!1}}(e)?(!function(e){e.contentEditable="true",e.addEventListener("keydown",(t=>{13==t.keyCode&&(t.preventDefault(),t.stopPropagation(),p(e,"\n"))})),e.addEventListener("paste",(t=>{t.preventDefault();let n=(t.originalEvent||t).clipboardData.getData("text/plain");p(e,n)}))}(e),e.textContent=s.sample):e.innerText=s.sample},async local(){gtag("event","show_local"),await navigator.permissions.query({name:"local-fonts",description:""});const e=await window.queryLocalFonts();0!=e.length&&(!function(e){const t=i.sheet;for(;t.cssRules.length;)t.deleteRule(0);for(const n of e)t.insertRule(`@font-face { font-family: 'local ${n.fullName}'; src: local('${n.fullName}'), local('${n.postscriptName}');}`)}(e),s.localFonts=e,u("#local").show())},async loadLocal(){gtag("event","open_local");const e=s.localFonts[s.localFont];let t;try{t=await e.blob()}catch(t){return alert("An error occur: "+t.message),void s.unavailableFonts.push(e.postscriptName)}finally{s.localFamily="",s.localFont=""}u("#local").hide();try{await F(t,e.fullName)}catch(e){alert("An error occur: "+e.message)}}}).mount()})),globalThis.generate=async function(){if(!s.message){gtag("event","save_"+s.options.format);try{if("showSaveFilePicker"in window){s.message=null;const e=await showSaveFilePicker({suggestedName:y(),types:[f[s.options.format]]});await h();const t=await w(),n=await fetch(t),o=await n.arrayBuffer(),a=new Blob([o],{type:"font/"+s.options.format}),i=await e.createWritable();await i.write(a),await i.close(),s.message="Generating complete!",setTimeout((()=>s.message=null),3e3)}else await h(),s.url=await w(),s.download=y()}catch(e){console.log(e)}s.running=!1}},globalThis.openFile=async function(e){const t=e.files[0];t&&(e.value="",b(t))}}();