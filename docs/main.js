!function(){const{reactive:e,createApp:t}=PetiteVue,n=new Worker("worker.js"),a=new Promise(((e,t)=>{const a=o=>{"initialized"==o.data?(n.removeEventListener("message",a),e()):"error"in o.data?t(new Error(o.data.error)):"progress"in o.data&&r.loading&&(r.loading=`packages (${o.data.progress}%)`)};n.addEventListener("message",a)})),o=document.createElement("style"),r=e({localFontSupport:"queryLocalFonts"in window,localFonts:[],localFont:"",unavailableFonts:[],loading:null,font:null,sample:"",removeGlyphs:"",previewSize:12,running:!1,message:null,previewIndex:0,version:""}),i=["abvm","abvs","akhn","blwf","blwm","blws","ccmp","cfar","cjct","curs","dist","dtls","fin2","fin3","fina","flac","half","haln","init","isol","ljmo","locl","ltra","ltrm","mark","med2","medi","mkmk","nukt","pref","pres","pstf","psts","rclt","rkrf","rlig","rphf","rtla","rtlm","rvrn","ssty","stch","tjmo","vjmo","DELT"],s={ital:"Italic",opsz:"Optical size",slnt:"Slant",wdth:"Width",wght:"Weight"},l={ttf:{description:"TTF font",accept:{"font/ttf":".ttf"}},woff2:{description:"WOFF2 font",accept:{"font/woff2":".woff2"}}},f=e=>bootstrap.Modal.getOrCreateInstance(e);let c,u;function g(e,t){return new Promise(((a,o)=>{const r=new MessageChannel;n.postMessage([e,t],[r.port2]),r.port1.onmessage=e=>{const{success:t,data:n}=e.data;t?a(n):o(new Error(n))}}))}function m(){const e=new Promise((e=>{addEventListener("animationstart",e,{once:!0})}));return r.running=!0,e}function p(){return r.font.fileName.replace(/\.[a-z0-9]+$/i,"")+"_freeze."+r.options.format}function d(e){return JSON.parse(JSON.stringify(e))}async function v(){try{for(let e in r.variations)r.variations[e]=Number(r.variations[e]);const e={options:r.options,version:r.version,unicodes:h(),variations:r.variations,features:r.font.gsub.filter((e=>!0===r.features[e])),disables:r.font.gsub.filter((e=>void 0===r.features[e]))};return await g("save",d(e))}catch(e){throw alert("An error occur: "+e.message),e}}async function w(e,t){r.loading="packages",await a,r.loading="font";let n,s=URL.createObjectURL(e);try{n=await g("open",s)}catch(e){throw URL.revokeObjectURL(s),e}finally{r.loading=null}console.log(d(n)),n.preview&&(URL.revokeObjectURL(s),s=n.preview),function(e){u&&URL.revokeObjectURL(u);u=e,o.sheet.cssRules.length>0&&o.sheet.deleteRule(0);o.sheet.insertRule(`@font-face {font-family: preview${++r.previewIndex};src: url('${u}');}`)}(s),n.fileName=t,n.fileSize=function(e){if(e<1024)return e+"B";e/=1024;if(e<1024)return e.toFixed(1)+"KiB";e/=1024;return e.toFixed(1)+"MiB"}(e.size),n.gsub=n.gsub.filter((e=>!i.includes(e))),r.features={},c={},r.variations={},r.removeGlyphs="",r.options={family:n.family+" Freeze",subfamily:"Regular",fixContour:!1,singleSub:!0,target:"calt",format:"ttf"};for(let e of n.gsub)r.features[e]=c[e]=!1;if(n.fvar)for(let e of n.fvar.axes)r.variations[e.tag]=e.default;r.font=n}function h(){const e=function(){const e=[];for(let t=0;t<r.removeGlyphs.length;t++)e.push(r.removeGlyphs.charCodeAt(t));return e.sort(),e}(),t=[[0,1114111]];if(0==e.length)return"";for(let n of e){const e=t.find((e=>e[0]<=n&&n<=e[1]));if(!e)continue;const a=e[1];e[1]=n-1,t.push([n+1,a])}return t.filter((e=>e[0]<=e[1])).map((e=>`U+${e[0].toString(16)}-${e[1].toString(16)}`)).join(",")}document.head.appendChild(o),fetch("sample.txt").then((e=>e.text())).then((e=>r.sample=e)),fetch("https://img.shields.io/github/package-json/v/mutsuntsai/fontfreeze.json").then((e=>e.json())).then((e=>r.version=" "+e.value)),addEventListener("DOMContentLoaded",(()=>t({store:r,get previewStyle(){if(!r.font)return null;const e=r.font.gsub.filter((e=>!1!==r.features[e])).map((e=>`'${e}' ${r.features[e]?"on":"off"}`)).join(","),t=r.font.fvar?r.font.fvar.axes.map((e=>`'${e.tag}' ${r.variations[e.tag]}`)).join(","):"normal";return`white-space: pre-line;font-family: preview${r.previewIndex};font-feature-settings: ${e};font-variation-settings: ${t};font-size: ${r.previewSize}pt;`},get more(){const e=r.font;return!!e&&(e.description||e.designer||e.manufacturer||e.copyright||e.trademark)},get instances(){return r.font&&r.font.fvar?r.font.fvar.instances:[]},get axes(){return r.font&&r.font.fvar?r.font.fvar.axes:[]},getAxisName:e=>e.name?e.name:e.tag in s?s[e.tag]:e.tag,setInstance(e){for(let t in e.coordinates)r.variations[t]=e.coordinates[t]},getStep(e){const t=e.max-e.min;return t>20?1:t>1?.1:.01},clear(){const e=document.getElementsByTagName("select")[0];e&&(e.value="")},checkboxChange(e){!0===c[e]&&(r.features[e]=void 0),void 0===c[e]&&(r.features[e]=!1),c[e]=r.features[e]},info(){f("#info").show()},setUnicodeRange(){o.sheet.cssRules[0].style.unicodeRange=h()},optionStyle(e){if(!e){if(!r.localFont)return"";e=r.localFonts[r.localFont]}return`font-family:'${e.fullName}', '${e.postscriptName}', '${e.family}'`},async local(){await navigator.permissions.query({name:"local-fonts",description:""});const e=await window.queryLocalFonts();0!=e.length&&(r.localFonts=e,f("#local").show())},async loadLocal(){const e=r.localFonts[r.localFont];let t;try{t=await e.blob()}catch(t){return alert("An error occur: "+t.message),void r.unavailableFonts.push(e.postscriptName)}finally{r.localFont=""}f("#local").hide();try{await w(t,e.fullName)}catch(e){alert("An error occur: "+e.message)}}}).mount())),globalThis.generate=async function(){if(!r.message){gtag("event","save_"+r.options.format);try{if("showSaveFilePicker"in window){r.message=null;const e=await showSaveFilePicker({suggestedName:p(),types:[l[r.options.format]]});await m();const t=await v(),n=await fetch(t),a=await n.arrayBuffer(),o=new Blob([a],{type:"font/"+r.options.format}),i=await e.createWritable();await i.write(o),await i.close(),r.message="Generating complete!",setTimeout((()=>r.message=null),3e3)}else await m(),r.url=await v(),r.download=p()}catch(e){console.log(e)}r.running=!1}},globalThis.openFile=async function(e){gtag("event","open_ttf");const t=e.files[0];if(t){e.value="";try{await w(t,t.name)}catch(e){console.log(e),alert(`"${t.name}" is not a valid font file.`)}}}}();